var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){"use strict";var e=window.crypto||window.msCrypto,t=window.localStorage,n="hexo-blog-encrypt:#"+window.location.pathname,r=d("hexo-blog-encrypt的作者们都是大帅比!"),o=d("hexo-blog-encrypt是地表最强Hexo加密插件!"),a=document.getElementById("hexo-blog-encrypt"),i=a.dataset.wpm,c=a.dataset.whm,l=a.getElementsByTagName("script").hbeData,u=l.innerText,s=l.dataset.hmacdigest;function y(e){return new Uint8Array(e.match(/[\da-f]{2}/gi).map(function(e){return parseInt(e,16)}))}function d(e){for(var t=e.length,n=0,r=new Array,o=0;o<t;){var a=e.codePointAt(o);a<128?(r[n++]=a,o++):a>127&&a<2048?(r[n++]=a>>6|192,r[n++]=63&a|128,o++):a>2047&&a<65536?(r[n++]=a>>12|224,r[n++]=a>>6&63|128,r[n++]=63&a|128,o++):(r[n++]=a>>18|240,r[n++]=a>>12&63|128,r[n++]=a>>6&63|128,r[n++]=63&a|128,o+=2)}return new Uint8Array(r)}async function f(e){var t=document.createElement("div");return t.innerHTML=e,t.querySelectorAll("script").forEach(async function(e){e.replaceWith(await async function(e){var t=document.createElement("script");return["type","text","src","crossorigin","defer","referrerpolicy"].forEach(function(n){e[n]&&(t[n]=e[n])}),t}(e))}),t}async function m(t,r,o){var a=y(u);return await e.subtle.decrypt({name:"AES-CBC",iv:r},t,a.buffer).then(async function(t){var r=(new TextDecoder).decode(t),a=document.createElement("button");a.textContent="Encrypt again",a.type="button",a.classList.add("hbe-button"),a.addEventListener("click",function(){window.localStorage.removeItem(n),window.location.reload()}),document.getElementById("hexo-blog-encrypt").style.display="inline",document.getElementById("hexo-blog-encrypt").innerHTML="",document.getElementById("hexo-blog-encrypt").appendChild(await f(r)),document.getElementById("hexo-blog-encrypt").appendChild(a),document.querySelectorAll("img").forEach(function(e){e.getAttribute("data-src")&&!e.src&&(e.src=e.getAttribute("data-src"))});var i=document.getElementById("toc-div");i&&(i.style.display="inline");var l=document.getElementsByClassName("toc-div-class");if(l&&l.length>0)for(var u=0;u<l.length;u++)l[u].style.display="inline";return await async function(t,n){var r=(new TextEncoder).encode(n),o=y(s),a=await e.subtle.verify({name:"HMAC",hash:"SHA-256"},t,o,r);return console.log("Verification result: "+a),a||(alert(c),console.log(c+", got ",o," but proved wrong.")),a}(o,r)}).catch(function(e){return alert(i),console.log(e),!1})}!function(){var i=JSON.parse(t.getItem(n));if(i){console.log("Password got from localStorage("+n+"): ",i);var c=y(i.iv).buffer,l=i.dk,u=i.hmk;e.subtle.importKey("jwk",l,{name:"AES-CBC",length:256},!0,["decrypt"]).then(function(r){e.subtle.importKey("jwk",u,{name:"HMAC",hash:"SHA-256",length:256},!0,["verify"]).then(function(e){m(r,c,e).then(function(e){e||t.removeItem(n)})})})}a.addEventListener("keydown",async function(a){if(a.isComposing||13===a.keyCode){var i=document.getElementById("hbePass").value,c=await function(t){var n=new TextEncoder;return e.subtle.importKey("raw",n.encode(t),{name:"PBKDF2"},!1,["deriveKey","deriveBits"])}(i),l=await function(t){return e.subtle.deriveKey({name:"PBKDF2",hash:"SHA-256",salt:r.buffer,iterations:1024},t,{name:"HMAC",hash:"SHA-256",length:256},!0,["verify"])}(c),u=await function(t){return e.subtle.deriveKey({name:"PBKDF2",hash:"SHA-256",salt:r.buffer,iterations:1024},t,{name:"AES-CBC",length:256},!0,["decrypt"])}(c),s=await function(t){return e.subtle.deriveBits({name:"PBKDF2",hash:"SHA-256",salt:o.buffer,iterations:512},t,128)}(c);m(u,s,l).then(function(r){console.log("Decrypt result: "+r),r&&e.subtle.exportKey("jwk",u).then(function(r){e.subtle.exportKey("jwk",l).then(function(e){var o={dk:r,iv:function(e){if("object"!==(void 0===e?"undefined":_typeof(e))||null===e||"number"!=typeof e.byteLength)throw new TypeError("Expected input to be an ArrayBuffer");for(var t,n=new Uint8Array(e),r="",o=0;o<n.length;o++)r+=1===(t=n[o].toString(16)).length?"0"+t:t;return r}(s),hmk:e};t.setItem(n,JSON.stringify(o))})})})}})}()}();